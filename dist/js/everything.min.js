var gameLogic;!function(a){function b(){for(var b=[],d=0;d<a.ROWS;d++){b[d]=[];for(var e=0;e<a.COLS;e++)b[d][e]=c()}return b}function c(){var b=Math.floor(Math.random()*a.num_of_colors+1);switch(b){case 1:return"R";case 2:return"G";case 3:return"B";case 4:return"X"}}function d(){for(var b=[],c=0;c<a.num_of_players;c++)b[c]=0;return b}function e(){return{board:b(),delta:null,current_turn:0,scores:d()}}function f(b){return b.current_turn>=a.total_turns&&g(b.scores)?!0:!1}function g(a){for(var b=a.join(",")+",",c=0;c<a.length;c++)if(b.replace(a[c]+",","").indexOf(a[c]+",")>-1)return!0;return!1}function h(b){if(f(b))return"";if(b.current_turn==a.total_turns)for(var c=Math.max.apply(null,b.scores),d=0;d<b.scores.length;d++)if(c==b.scores[d])return d+1+"";return""}function i(a,b,c){for(var d=0;d<a.length;d++)if(a[d].row===b&&a[d].col===c)return!0;return!1}function j(b,c){for(var d=0,e=b,f=[],g=!1,h=!1,j=!1,n=!1,o=0;o<a.ROWS;o++){f[o]=[];for(var p=0;p<a.COLS;p++)f[o][p]=!1}for(var o=0;o<a.ROWS;o++)for(var q=k(c,o),p=0;p<a.COLS;p++)p>=q.left&&p<=q.right?f[o][p]=!0:f[o][p]=!1;for(var o=0;o<a.COLS;o++)for(var q=l(c,o),p=0;p<a.ROWS;p++)if(p>=q.left&&p<=q.right&&1==f[p][o]){if(!i(c,p,o))switch(b[p][o]){case"R":g=!0;break;case"G":h=!0;break;case"B":j=!0;break;case"X":n=!0}}else f[p][o]=!1;for(var o=0;o<a.ROWS;o++)for(var p=0;p<a.COLS;p++)g===!0&&"R"===b[o][p]?f[o][p]=!0:h===!0&&"G"===b[o][p]?f[o][p]=!0:j===!0&&"B"===b[o][p]?f[o][p]=!0:n===!0&&"X"===b[o][p]&&(f[o][p]=!0),f[o][p]===!0&&d++;for(var p=a.COLS-1;p>=0;p--)for(var r=a.ROWS-1,o=a.ROWS-1;o>=0;o--){var s=m(e,f,r,o,p);r=s.flag,e[o][p]=s.color,r--}return{score:d,board:e}}function k(a,b){for(var c=100,d=-2,e=0;e<a.length;e++)a[e].row===b&&(c=Math.min(a[e].col,c),d=Math.max(a[e].col,d));return{left:c,right:d}}function l(a,b){for(var c=100,d=-2,e=0;e<a.length;e++)a[e].col===b&&(c=Math.min(a[e].row,c),d=Math.max(a[e].row,d));return{left:c,right:d}}function m(a,b,d,e,f){for(;d>=0&&b[d][f]!==!1;)d--;return 0>d?{color:c(),flag:d}:{color:a[d][f],flag:d}}function n(c,d,g){c||(c=e());var i=c.board;if(p(i,d),f(c)||""!==h(c))throw new Error("Can only make a move if the game is not over!");var k=angular.copy(i),l=j(k,d);for(k=l.board;!o(k);)k=b();var m=angular.copy(c.scores);m[g]+=l.score;var n,q,r={board:k,delta:d,current_turn:c.current_turn+1,scores:m},s=h(r);return""!==s||f(r)?(q=-1,n="1"===s?[1,0]:"2"===s?[0,1]:[0,0]):(q=a.num_of_players-1-g,n=null),{endMatchScores:n,turnIndexAfterMove:q,stateAfterMove:r}}function o(b){for(var c=0;c<a.ROWS;c++)for(var d=0;d<a.COLS;d++)if(d-1>=0&&c+1<=a.ROWS-1){if(b[c][d]===b[c][d-1]&&b[c][d]===b[c+1][d])return!0}else if(d+1<=a.COLS-1&&c+1<=a.ROWS-1){if(b[c][d]===b[c][d+1]&&b[c][d]===b[c+1][d])return!0}else if(c+1<=a.ROWS-1&&d-1>=0){if(b[c][d]===b[c+1][d]&&b[c][d]===b[c+1][d-1])return!0}else if(c+1<=a.ROWS-1&&d+1<=a.COLS-1){if(b[c][d]===b[c+1][d]&&b[c][d]===b[c+1][d+1])return!0}else if(c>=1&&c<a.ROWS-1&&d>=1&&d<a.COLS-1&&b[c-1][d]===b[c][d-1]&&b[c][d-1]===b[c+1][d]&&b[c+1][d]===b[c][d+1])return!0;return!1}function p(a,b){for(var c=0;c<b.length;c++)if(b[c].row<0||b[c].col<0||b[c].row>=8||b[c].col>=6)throw new Error("All moves should be positive");if(b.length<=3)throw new Error("You should draw a circle with at least three points");if(b[0].row!==b[b.length-1].row||b[0].col!==b[b.length-1].col)throw new Error("You should draw a enclosed circle");if(q(b))throw new Error("You should a draw enclosed circle without duplicates");for(var c=1;c<b.length;c++){if(!(Math.abs(b[c].row-b[c-1].row)<=1&&Math.abs(b[c].col-b[c-1].col)<=1))throw new Error("Point selected should be closed to the previous one");if(a[b[c].row][b[c].col]!==a[b[c-1].row][b[c-1].col])throw log.info("after",angular.toJson(a)),new Error("Points should all be the same color")}return!0}function q(b){for(var c=[],d=0;d<b.length-1;d++)c[d]=b[d].row*a.COLS+b[d].col;var e=c.sort();log.info(e);for(var d=0;d<e.length-1;d++)if(e[d]===e[d+1])return!0;return!1}function r(a){var b=a.turnIndexBeforeMove,c=a.stateBeforeMove,d=a.move,e=a.move.stateAfterMove.delta,f=n(c,e,b);if(!angular.equals(d,f))throw new Error("Expected move="+angular.toJson(f,!0)+", but got stateTransition="+angular.toJson(a,!0))}function s(a){}function t(){var b=a.createMove(null,[{row:0,col:0}],0);log.log("move=",b);var c={turnIndexBeforeMove:0,stateBeforeMove:null,move:b,numberOfPlayers:2};a.checkMoveOk(c)}a.ROWS=8,a.COLS=6,a.num_of_players=2,a.total_turns=20,a.num_of_colors=4,a.getInitialState=e,a.createMove=n,a.checkMoveOk=r,a.checkMoveOkNoOp=s,a.forSimpleTestHtml=t}(gameLogic||(gameLogic={}));var game;!function(a){function b(){translate.setTranslations(c()),translate.setLanguage("en"),log.log("Translation of 'RULES_OF_ENCLOSECOMBAT' is "+translate("RULES_OF_ENCLOSECOMBAT")),resizeGameAreaService.setWidthToHeight(.6818),moveService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,checkMoveOk:gameLogic.checkMoveOkNoOp,updateUI:f});var a=window;a.HTMLInspector&&setInterval(function(){a.HTMLInspector.inspect({excludeRules:["unused-classes","script-placement"]})},3e3)}function c(){return{RULES_OF_ENCLOSECOMBAT:{en:"Rules of EncloseCombat",zh:"滑块大战的规则"},ENCLOSECOMBAT_RULES_SLIDE1:{en:"You and your opponent take turns to draw an enclosed shape over the chips of same color. The more the area is, the higher the score will be.",zh:"你和你的对手轮流操作，在相同颜色的卡片上围成一个闭合的形状。然后这个形状上和其内的卡片会消失，上面的会掉下来，新的卡片也会补充进来。"},ENCLOSECOMBAT_RULES_SLIDE2:{en:"If you have chips INSIDE the shape, all the same color chips will be gone with an extra bonus. After 20 turns, player with higher score win.",zh:"如果内部有色块，所有相同颜色的色块都会消失，你也会得到奖励。面积越大，分数越高，二十个回合之后分数高的人获胜。"},CLOSE:{en:"Close",zh:"关闭"},LEFT_TURNS:{en:"Turns left",zh:"剩余回合"},PLAYER:{en:"Player",zh:"玩家"}}}function d(){log.info("Hi"),$rootScope.$apply(function(){log.info("Animation ended"),a.animationEnded=!0,e()})}function e(){if(h()){log.info("computer"),a.didMakeMove=!0;var b=document.getElementById("rline"),c=document.getElementById("gameArea"),d=c.clientWidth/gameLogic.COLS,e=.9*c.clientHeight/gameLogic.ROWS;b.setAttribute("style","fill:none;stroke:black;stroke-dasharray: 5;animation: dash 1.5s linear;stroke-width:1.5%; stroke-opacity: 0.7");var f="",g=aiService.findSimplyComputerMove(a.currentUpdateUI.move);g.stateAfterMove.delta.forEach(function(a){var b=a.col*d+d/2,c=a.row*e+e/2;f=f+b+","+c+" "}),b.setAttribute("points",f),setTimeout(function(){b.setAttribute("points",""),b.setAttribute("style","fill:none;stroke:white;stroke-width:1.5%; stroke-opacity: 0"),moveService.makeMove(g)},2e3)}}function f(b){log.info("Game got updateUI???:",b),a.animationEnded=!1,a.didMakeMove=!1,a.currentUpdateUI=b;var c=(document.getElementById("rline"),document.getElementById("gameArea"));c.clientWidth/gameLogic.COLS,.9*c.clientHeight/gameLogic.ROWS;if(g(),i())a.state=gameLogic.getInitialState(),e();else if(k()&&"passAndPlay"!==a.currentUpdateUI.playMode&&"playAgainstTheComputer"!==a.currentUpdateUI.playMode){a.state=b.stateBeforeMove,log.info("try me",k());var f=document.getElementById("rline"),h=document.getElementById("gameArea"),j=h.clientWidth/gameLogic.COLS,l=.9*h.clientHeight/gameLogic.ROWS,m="";a.currentUpdateUI.move.stateAfterMove.delta.forEach(function(a){var b=a.col*j+j/2,c=a.row*l+l/2;m=m+b+","+c+" "}),f.setAttribute("points",m),f.setAttribute("style","fill:none;stroke:white;stroke-dasharray: 5;animation: dash 2s linear;stroke-width:1.5%; stroke-opacity: 0.7"),setTimeout(function(){f.setAttribute("points",""),a.state=a.currentUpdateUI.move.stateAfterMove,a.animationEndedTimeout=$timeout(d,1e3)},2e3)}else a.state=a.currentUpdateUI.move.stateAfterMove,a.animationEndedTimeout=$timeout(d,1e3)}function g(){a.animationEndedTimeout&&($timeout.cancel(a.animationEndedTimeout),a.animationEndedTimeout=null)}function h(){return k()&&j()}function i(){return!a.currentUpdateUI.move.stateAfterMove}function j(){return void 0!==a.currentUpdateUI.playersInfo[a.currentUpdateUI.yourPlayerIndex]&&""===a.currentUpdateUI.playersInfo[a.currentUpdateUI.yourPlayerIndex].playerId}function k(){return!a.didMakeMove&&a.currentUpdateUI.move.turnIndexAfterMove>=0&&a.currentUpdateUI.yourPlayerIndex===a.currentUpdateUI.move.turnIndexAfterMove}function l(b){return a.currentUpdateUI.move.turnIndexAfterMove==b}function m(b,c){a.moves.push({row:b,col:c})}function n(b,c){0===a.moves.length||1===a.moves.length&&a.moves[0]==={row:b,col:c}||a.moves.push({row:b,col:c})}function o(){log.info("Slided on cell:",angular.toJson(a.moves));document.getElementById("remindlines");if("?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");try{var b=gameLogic.createMove(a.state,a.moves,a.currentUpdateUI.move.turnIndexAfterMove);moveService.makeMove(b),a.moves=new Array}catch(c){return log.info(c),void(a.moves=new Array)}}function p(a,b){return!0}function q(b,c){return"R"===a.state.board[b][c]}function r(b,c){return"G"===a.state.board[b][c]}function s(b,c){return"B"===a.state.board[b][c]}function t(b,c){return"X"===a.state.board[b][c]}function u(b,c){var d=!1;if(null!==a.state.delta)for(var e=0;e<a.state.delta.length;e++)a.state.delta[e].row>=b&&a.state.delta[e].col===c&&(d=!0);return!a.animationEnded&&a.state.delta&&d}function v(b){return b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.isHelpModalShown=!1),!0}a.currentUpdateUI=null,a.animationEnded=!1,a.didMakeMove=!1,a.state=null,a.isHelpModalShown=!1,a.moves=new Array,a.msg="",a.animationEndedTimeout=null,a.init=b,a.isComputer=j,a.isMyTurn=k,a.isCurrentPlayerIndex=l,a.cellPressedDown=m,a.cellEnter=n,a.cellPressedUp=o,a.shouldShowImage=p,a.isPieceR=q,a.isPieceG=r,a.isPieceB=s,a.isPieceX=t,a.shouldSlowlyAppear=u,a.clickedOnModal=v}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){"use strict";function a(a,c,n){var o,p,q=f.offsetTop+.1*f.clientHeight,r=.9*f.clientHeight,s=c-f.offsetLeft,t=n-q;if(0>s||0>t||s>=f.clientWidth||t>=r){if(!l)return g.style.display="none",void g.offsetHeight}else{p=Math.floor(k*s/f.clientWidth),o=Math.floor(j*t/r);var u=r/2/j*(2*o+1),v=f.clientWidth/2/k*(2*p+1),w=Math.sqrt((s-v)*(s-v)+(t-u)*(t-u))/(r/2/j);if(0!==game.moves.length){var x=d(game.moves[game.moves.length-1].row,game.moves[game.moves.length-1].col);i.setAttribute("x1",x.x+""),i.setAttribute("y1",x.y+""),i.setAttribute("x2",s+""),i.setAttribute("y2",t+"")}if(w>.7)return void(("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(game.moves=new Array,h.setAttribute("points",""),g.style.display="none",g.style.webkitTransform="scale(1)",g.offsetHeight));if("touchstart"!==a||m||(m={row:o,col:p},l=document.getElementById("e2e_test_div_"+m.row+"x"+m.col)),!l)return;if("touchend"===a){if(game.moves[game.moves.length-1].row!==o||game.moves[game.moves.length-1].col!==p){var y=game.isPieceR(o,p)?document.getElementById("e2e_test_pieceR_"+o+"x"+p):game.isPieceG(o,p)?document.getElementById("e2e_test_pieceG_"+o+"x"+p):game.isPieceB(o,p)?document.getElementById("e2e_test_pieceB_"+o+"x"+p):document.getElementById("e2e_test_pieceX_"+o+"x"+p);y.setAttribute("r","55%"),setTimeout(function(){y.setAttribute("r","40%")},100),l=document.getElementById("e2e_test_div_"+o+"x"+p),game.moves.push({row:o,col:p})}log.info(angular.toJson(game.moves)),e()}else if((0===game.moves.length||(game.moves[game.moves.length-1].row!==o||game.moves[game.moves.length-1].col!==p)&&Math.abs(game.moves[game.moves.length-1].row-o)<=1&&Math.abs(game.moves[game.moves.length-1].col-p)<=1)&&(game.moves.length<2||2===game.moves.length&&(game.moves[0].row!==o||game.moves[0].col!==p)||game.moves.length>2&&!b(game.moves,o,p))){var y=game.isPieceR(o,p)?document.getElementById("e2e_test_pieceR_"+o+"x"+p):game.isPieceG(o,p)?document.getElementById("e2e_test_pieceG_"+o+"x"+p):game.isPieceB(o,p)?document.getElementById("e2e_test_pieceB_"+o+"x"+p):document.getElementById("e2e_test_pieceX_"+o+"x"+p);y.setAttribute("r","55%"),y.setAttribute("r","45%"),setTimeout(function(){y.setAttribute("r","40%")},100),l=document.getElementById("e2e_test_div_"+o+"x"+p),game.moves.push({row:o,col:p}),g.style.display="block","touchstart"===a&&(i.setAttribute("x1","0"),i.setAttribute("y1","0"),i.setAttribute("x2","0"),i.setAttribute("y2","0"));var z=d(o,p);if(1==game.moves.length)h.setAttribute("points",z.x+","+z.y+" ");else{var A=h.getAttribute("points");h.setAttribute("points",A+z.x+","+z.y+" ")}}}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(m=null,l=null,g.style.display="none",g.offsetHeight,g.style.webkitTransform="scale(1)",game.moves=new Array)}function b(a,b,c){for(var d=1;d<a.length;d++)if(a[d].row===b&&a[d].col===c)return!0;return!1}function c(){return{width:f.clientWidth/k,height:.9*f.clientHeight/j}}function d(a,b){var d=c();return{x:b*d.width+d.width/2,y:a*d.height+d.height/2}}function e(){$rootScope.$apply(function(){game.cellPressedUp()})}var f=document.getElementById("gameArea"),g=document.getElementById("draggingLines"),h=document.getElementById("pline"),i=document.getElementById("pline2");dragAndDropService.addDragListener("gameArea",a);var j=gameLogic.ROWS,k=gameLogic.COLS,l=null,m=null;$rootScope.game=game,game.init(),resizeGameAreaService.setWidthToHeight(.6818)});var aiService;!function(a){function b(a){for(var b=null,c=1;c<gameLogic.ROWS-1;c++)for(var d=1;d<gameLogic.COLS-1;d++){var e=new Array;try{return e.push({row:c-1,col:d}),e.push({row:c,col:d+1}),e.push({row:c+1,col:d}),e.push({row:c,col:d-1}),e.push({row:c-1,col:d}),b=gameLogic.createMove(a.stateAfterMove,e,a.turnIndexAfterMove)}catch(f){}}for(var c=0;c<gameLogic.ROWS;c++)for(var d=1;d<gameLogic.COLS;d++)for(var g=0;3>=g;g++)try{var e=new Array;switch(e.push({row:c,col:d-1}),e.push({row:c,col:d}),g){case 0:e.push({row:c-1,col:d-1});break;case 1:e.push({row:c-1,col:d});break;case 2:e.push({row:c+1,col:d});break;case 3:e.push({row:c+1,col:d-1})}return e.push({row:c,col:d-1}),b=gameLogic.createMove(a.stateAfterMove,e,a.turnIndexAfterMove)}catch(f){}return b}function c(a){for(var b=null,c=0,e=new Array,f=new Array,g=new Array,h=0;h<gameLogic.ROWS;h++){f[h]=new Array;for(var i=0;i<gameLogic.COLS;i++)f[h][i]=!1}log.info("rrr");try{for(var h=0;h<gameLogic.ROWS;h++)for(var i=0;i<gameLogic.COLS;i++){var j=d(a.stateAfterMove.board,h,i,"",g,f);j.len>c&&(e=j.moves)}b=gameLogic.createMove(a.stateAfterMove,e,a.turnIndexAfterMove)}catch(k){log.info(k)}return b}function d(a,b,c,e,f,g){if(0>b||b>gameLogic.ROWS||0>c||c>gameLogic.COLS||""!==e&&a[b][c]!==e)return{len:0,moves:null};if(""!==e&&null!==f&&f.length>=3&&g[b][c]===!0&&b===f[0].row&&c===f[0].col)return f.push({row:b,col:c}),{len:f.length-1,moves:f};""===e&&(e=a[b][c]),g[b][c]=!0,f.push({row:b,col:c});var h=new Array;b+1<gameLogic.ROWS&&a[b+1][c]===e&&h.push(d(a,b+1,c,e,f,g)),b+1<gameLogic.ROWS&&c+1<gameLogic.COLS&&a[b+1][c+1]===e&&h.push(d(a,b+1,c+1,e,f,g)),b+1<gameLogic.ROWS&&c-1>0&&a[b+1][c-1]===e&&h.push(d(a,b+1,c-1,e,f,g)),c+1<gameLogic.COLS&&a[b][c+1]===e&&h.push(d(a,b,c+1,e,f,g)),c-1>0&&a[b][c-1]===e&&h.push(d(a,b,c-1,e,f,g)),b-1>0&&c-1>0&&a[b-1][c-1]===e&&h.push(d(a,b-1,c-1,e,f,g)),b-1>0&&a[b-1][c]===e&&h.push(d(a,b-1,c,e,f,g)),b-1>0&&c+1<gameLogic.COLS&&a[b-1][c+1]===e&&h.push(d(a,b-1,c+1,e,f,g)),f.pop(),g[b][c]=!1;for(var i=0,j=new Array,k=0;k<h.length;k++)h[k].len>i&&(i=h[k].len,j=h[k].moves);return{len:i,moves:j}}function e(a){return g(a,{millisecondsLimit:1e3})}function f(a,b){for(var c=[],d=0;d<gameLogic.ROWS;d++)for(var e=0;e<gameLogic.COLS;e++)try{}catch(f){}return c}function g(a,b){return alphaBetaService.alphaBetaDecision(a,a.turnIndexAfterMove,i,h,null,b)}function h(a,b){var c=a.endMatchScores;return c?c[0]>c[1]?Number.POSITIVE_INFINITY:c[0]<c[1]?Number.NEGATIVE_INFINITY:0:0}function i(a,b){return f(a.stateAfterMove,b)}a.findSimplyComputerMove=b,a.findCleverComputerMove=c,a.findComputerMove=e,a.getPossibleMoves=f,a.createComputerMove=g}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map