var gameLogic;!function(a){function b(){for(var b=[],d=0;d<a.ROWS;d++){b[d]=[];for(var e=0;e<a.COLS;e++)b[d][e]=c()}return b}function c(){var b=Math.floor(Math.random()*a.num_of_colors+1);switch(b){case 1:return"R";case 2:return"G";case 3:return"B"}}function d(){for(var b=[],c=0;c<a.num_of_players;c++)b[c]=0;return b}function e(){return{board:b(),delta:null,current_turn:1,scores:d()}}function f(b){return b.current_turn>=a.total_turns&&g(b.scores)?!0:!1}function g(a){for(var b=a.join(",")+",",c=0;c<a.length;c++)if(b.replace(a[c]+",","").indexOf(a[c]+",")>-1)return!0;return!1}function h(b){if(f(b))return"";if(b.current_turn==a.total_turns)for(var c=Math.max.apply(null,b.scores),d=0;d<b.scores.length;d++)if(c==b.scores[d])return d+1+"";return""}function i(b,c){for(var d=0,e=b,f=[],g=0;g<a.ROWS;g++){f[g]=[];for(var h=0;h<a.COLS;h++)f[g][h]=!1}for(var g=0;g<a.ROWS;g++)for(var i=j(c,g),h=0;h<a.COLS;h++)h>=i.left&&h<=i.right?f[g][h]=!0:f[g][h]=!1;for(var g=0;g<a.COLS;g++)for(var i=k(c,g),h=0;h<a.ROWS;h++)h>=i.left&&h<=i.right&&1==f[h][g]?d++:f[h][g]=!1;for(var h=a.COLS-1;h>=0;h--)for(var m=a.ROWS-1,g=a.ROWS-1;g>=0;g--){var n=l(e,f,m,g,h);m=n.flag,e[g][h]=n.color,m--}return{score:d,board:e}}function j(a,b){for(var c=100,d=-2,e=0;e<a.length;e++)a[e].row===b&&(c=Math.min(a[e].col,c),d=Math.max(a[e].col,d));return{left:c,right:d}}function k(a,b){for(var c=100,d=-2,e=0;e<a.length;e++)a[e].col===b&&(c=Math.min(a[e].row,c),d=Math.max(a[e].row,d));return{left:c,right:d}}function l(a,b,d,e,f){for(;d>=0&&b[d][f]!==!1;)d--;return 0>d?{color:c(),flag:d}:{color:a[d][f],flag:d}}function m(b,c,d){b||(b=e());var g=b.board;if(n(g,c),f(b)||""!==h(b))throw new Error("Can only make a move if the game is not over!");var j=angular.copy(g),k=i(j,c);j=k.board;var l=angular.copy(b.scores);l[d]+=k.score;var m,o,p={board:j,delta:c,current_turn:b.current_turn+1,scores:l},q=h(p);return""!==q||f(p)?(o=-1,m="1"===q?[1,0]:"2"===q?[0,1]:[0,0]):(o=a.num_of_players-1-d,m=null),{endMatchScores:m,turnIndexAfterMove:o,stateAfterMove:p}}function n(a,b){for(var c=0;c<b.length;c++)if(b[c].row<0||b[c].col<0||b[c].row>=8||b[c].col>=6)throw new Error("All moves should be positive");if(b.length<=3)throw new Error("You should draw a circle with at least three points");if(b[0].row!==b[b.length-1].row||b[0].col!==b[b.length-1].col)throw new Error("You should draw a enclosed circle");if(o(b))throw new Error("You should a draw enclosed circle without duplicates");for(var c=1;c<b.length;c++){if(!(Math.abs(b[c].row-b[c-1].row)<=1&&Math.abs(b[c].col-b[c-1].col)<=1))throw new Error("Point selected should be closed to the previous one");if(a[b[c].row][b[c].col]!==a[b[c-1].row][b[c-1].col])throw log.info("after",angular.toJson(a)),new Error("Points should all be the same color")}return!0}function o(b){for(var c=[],d=0;d<b.length-1;d++)c[d]=b[d].row*a.COLS+b[d].col;for(var e=c.join(",")+",",d=0;d<c.length;d++)if(e.replace(c[d]+",","").indexOf(c[d]+",")>-1)return!0;return!1}function p(a){var b=a.turnIndexBeforeMove,c=a.stateBeforeMove,d=a.move,e=a.move.stateAfterMove.delta,f=m(c,e,b);if(!angular.equals(d,f))throw new Error("Expected move="+angular.toJson(f,!0)+", but got stateTransition="+angular.toJson(a,!0))}function q(a){}function r(){var b=a.createMove(null,[{row:0,col:0}],0);log.log("move=",b);var c={turnIndexBeforeMove:0,stateBeforeMove:null,move:b,numberOfPlayers:2};a.checkMoveOk(c)}a.ROWS=8,a.COLS=6,a.num_of_players=2,a.total_turns=10,a.num_of_colors=3,a.getInitialState=e,a.createMove=m,a.checkMoveOk=p,a.checkMoveOkNoOp=q,a.forSimpleTestHtml=r}(gameLogic||(gameLogic={}));var game;!function(a){function b(){translate.setTranslations(c()),translate.setLanguage("en"),log.log("Translation of 'RULES_OF_ENCLOSECOMBAT' is "+translate("RULES_OF_ENCLOSECOMBAT")),resizeGameAreaService.setWidthToHeight(1),moveService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,checkMoveOk:gameLogic.checkMoveOkNoOp,updateUI:f}),document.addEventListener("animationend",d,!1),document.addEventListener("webkitAnimationEnd",d,!1),document.addEventListener("oanimationend",d,!1),setTimeout(d,1e3);var a=window;a.HTMLInspector&&setInterval(function(){a.HTMLInspector.inspect({excludeRules:["unused-classes","script-placement"]})},3e3)}function c(){return{RULES_OF_ENCLOSECOMBAT:{en:"Rules of EncloseCombat",cn:"画圈大战的规则"},RULES_SLIDE1:{en:"You and your opponent take turns to draw an enclosed circle over the chips of same color.",cn:"你和你的对手轮流操作，在相同颜色的卡片上围成一个闭合的形状。然后这个形状上和其内的卡片会消失，上面的会掉下来，新的卡片也会补充进来。"},RULES_SLIDE2:{en:"The more chips you include in that circle, the higher score you get.",cn:"形状越大分数越高，十个回合之后分数高的人获胜。"},CLOSE:{en:"Close",cn:"关闭"}}}function d(){log.info("Hi"),$rootScope.$apply(function(){log.info("Animation ended"),a.animationEnded=!0,e()})}function e(){a.isComputerTurn&&(a.isComputerTurn=!1,log.info("computer"),moveService.makeMove(aiService.findSimplyComputerMove(a.move)))}function f(b){log.info("Game got updateUI:",b),a.animationEnded=!1,a.move=b.move,a.state=a.move.stateAfterMove,a.state||(a.state=gameLogic.getInitialState()),a.canMakeMove=a.move.turnIndexAfterMove>=0&&b.yourPlayerIndex===a.move.turnIndexAfterMove,a.isComputerTurn=a.canMakeMove&&""===b.playersInfo[b.yourPlayerIndex].playerId,a.isComputerTurn&&(a.canMakeMove=!1,a.state.delta||e())}function g(b,c){a.moves.push({row:b,col:c})}function h(b,c){0===a.moves.length||1===a.moves.length&&a.moves[0]==={row:b,col:c}||a.moves.push({row:b,col:c})}function i(){if(log.info("Slided on cell:",angular.toJson(a.moves)),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.canMakeMove)try{var b=gameLogic.createMove(a.state,a.moves,a.move.turnIndexAfterMove);a.canMakeMove=!1,moveService.makeMove(b),a.moves=new Array}catch(c){return log.info(c),void(a.moves=new Array)}}function j(a,b){return!0}function k(b,c){return"R"===a.state.board[b][c]}function l(b,c){return"G"===a.state.board[b][c]}function m(b,c){return"B"===a.state.board[b][c]}function n(b,c){var d=!1;if(null!==a.state.delta)for(var e=0;e<a.state.delta.length;e++)a.state.delta[e].row>=b&&a.state.delta[e].col===c&&(d=!0);return!a.animationEnded&&a.state.delta&&d}function o(b){return b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.isHelpModalShown=!1),!0}a.animationEnded=!1,a.canMakeMove=!1,a.isComputerTurn=!1,a.move=null,a.state=null,a.isHelpModalShown=!1,a.moves=new Array,a.init=b,a.cellPressedDown=g,a.cellEnter=h,a.cellPressedUp=i,a.shouldShowImage=j,a.isPieceR=k,a.isPieceG=l,a.isPieceB=m,a.shouldSlowlyAppear=n,a.clickedOnModal=o}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){"use strict";function a(a,d,o){var p,q,r=d-g.offsetLeft,s=o-g.offsetTop;if(0>r||0>s||r>=g.clientWidth||s>=g.clientHeight){if(h.style.display="none",!m)return;var t=c();b({top:s-t.height/2,left:r-t.width/2})}else{q=Math.floor(l*r/g.clientWidth),p=Math.floor(k*s/g.clientHeight);var u=g.clientHeight/2/k*(2*p+1),v=g.clientWidth/2/l*(2*q+1),w=Math.sqrt((r-v)*(r-v)+(s-u)*(s-u))/(g.clientHeight/2/k);if(0!==game.moves.length){var x=e(game.moves[game.moves.length-1].row,game.moves[game.moves.length-1].col);j.setAttribute("x1",x.x+""),j.setAttribute("y1",x.y+""),j.setAttribute("x2",r+""),j.setAttribute("y2",s+"")}if(w>.5)return void(("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(game.moves=new Array,i.setAttribute("points",""),h.style.display="none"));if("touchstart"!==a||n||(n={row:p,col:q},m=document.getElementById("e2e_test_div_"+n.row+"x"+n.col)),!m)return;if("touchend"===a){if(game.moves[game.moves.length-1].row!==p||game.moves[game.moves.length-1].col!==q){var y=game.isPieceR(p,q)?document.getElementById("e2e_test_pieceR_"+p+"x"+q):game.isPieceG(p,q)?document.getElementById("e2e_test_pieceG_"+p+"x"+q):document.getElementById("e2e_test_pieceB_"+p+"x"+q);y.setAttribute("r","55%"),setTimeout(function(){y.setAttribute("r","40%")},100),m=document.getElementById("e2e_test_div_"+p+"x"+q),game.moves.push({row:p,col:q})}log.info(angular.toJson(game.moves)),f()}else if(0==game.moves.length||game.moves[game.moves.length-1].row!==p||game.moves[game.moves.length-1].col!==q){var y=game.isPieceR(p,q)?document.getElementById("e2e_test_pieceR_"+p+"x"+q):game.isPieceG(p,q)?document.getElementById("e2e_test_pieceG_"+p+"x"+q):document.getElementById("e2e_test_pieceB_"+p+"x"+q);y.setAttribute("r","45%"),setTimeout(function(){y.setAttribute("r","40%")},100),m=document.getElementById("e2e_test_div_"+p+"x"+q),game.moves.push({row:p,col:q}),h.style.display="inline","touchstart"===a&&(j.setAttribute("x1","0"),j.setAttribute("y1","0"),j.setAttribute("x2","0"),j.setAttribute("y2","0"));var z=e(p,q);if(1==game.moves.length)i.setAttribute("points",z.x+","+z.y+" ");else{var A=i.getAttribute("points");i.setAttribute("points",A+z.x+","+z.y+" ")}}}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(n=null,m=null,h.style.display="none",game.moves=new Array)}function b(a){var b=d(n.row,n.col);m.style.left=a.left-b.left+"px",m.style.top=a.top-b.top+"px"}function c(){return{width:g.clientWidth/l,height:g.clientHeight/k}}function d(a,b){var d=c();return{top:a*d.height,left:b*d.width}}function e(a,b){var d=c();return{x:b*d.width+d.width/2,y:a*d.height+d.height/2}}function f(){$rootScope.$apply(function(){game.cellPressedUp()})}var g=document.getElementById("gameArea"),h=document.getElementById("draggingLines"),i=document.getElementById("pline"),j=document.getElementById("pline2");dragAndDropService.addDragListener("gameArea",a);var k=gameLogic.ROWS,l=gameLogic.COLS,m=null,n=null;$rootScope.game=game,game.init(),resizeGameAreaService.setWidthToHeight(.75)});var aiService;!function(a){function b(a){for(var b=null,c=0;c<gameLogic.ROWS;c++)for(var d=1;d<gameLogic.COLS;d++)for(var e=0;3>=e;e++)try{var f=new Array;switch(f.push({row:c,col:d-1}),f.push({row:c,col:d}),e){case 0:f.push({row:c-1,col:d-1});break;case 1:f.push({row:c-1,col:d});break;case 2:f.push({row:c+1,col:d});break;case 3:f.push({row:c+1,col:d-1})}return f.push({row:c,col:d-1}),b=gameLogic.createMove(a.stateAfterMove,f,a.turnIndexAfterMove)}catch(g){}return b}function c(a){return e(a,{millisecondsLimit:1e3})}function d(a,b){for(var c=[],d=0;d<gameLogic.ROWS;d++)for(var e=0;e<gameLogic.COLS;e++)try{}catch(f){}return c}function e(a,b){return alphaBetaService.alphaBetaDecision(a,a.turnIndexAfterMove,g,f,null,b)}function f(a,b){var c=a.endMatchScores;return c?c[0]>c[1]?Number.POSITIVE_INFINITY:c[0]<c[1]?Number.NEGATIVE_INFINITY:0:0}function g(a,b){return d(a.stateAfterMove,b)}a.findSimplyComputerMove=b,a.findComputerMove=c,a.getPossibleMoves=d,a.createComputerMove=e}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map