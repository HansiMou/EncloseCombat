var gameLogic;!function(a){function b(){for(var b=[],d=0;d<a.ROWS;d++){b[d]=[];for(var e=0;e<a.COLS;e++)b[d][e]=c()}return b}function c(){var b=Math.floor(Math.random()*a.num_of_colors+1);switch(b){case 1:return"R";case 2:return"G";case 3:return"B"}}function d(){for(var b=[],c=0;c<a.num_of_players;c++)b[c]=0;return b}function e(){return{board:b(),delta:null,current_turn:0,scores:d()}}function f(b){return b.current_turn>=a.total_turns&&g(b.scores)?!0:!1}function g(a){for(var b=a.join(",")+",",c=0;c<a.length;c++)if(b.replace(a[c]+",","").indexOf(a[c]+",")>-1)return!0;return!1}function h(b){if(f(b))return"";if(b.current_turn==a.total_turns)for(var c=Math.max.apply(null,b.scores),d=0;d<b.scores.length;d++)if(c==b.scores[d])return d+1+"";return""}function i(a,b,c){for(var d=0;d<a.length;d++)if(a[d].row===b&&a[d].col===c)return!0;return!1}function j(b,c){for(var d=0,e=b,f=[],g=!1,h=!1,j=!1,n=0;n<a.ROWS;n++){f[n]=[];for(var o=0;o<a.COLS;o++)f[n][o]=!1}for(var n=0;n<a.ROWS;n++)for(var p=k(c,n),o=0;o<a.COLS;o++)o>=p.left&&o<=p.right?f[n][o]=!0:f[n][o]=!1;for(var n=0;n<a.COLS;n++)for(var p=l(c,n),o=0;o<a.ROWS;o++)if(o>=p.left&&o<=p.right&&1==f[o][n]){if(!i(c,o,n))switch(b[o][n]){case"R":g=!0;break;case"G":h=!0;break;case"B":j=!0}}else f[o][n]=!1;for(var n=0;n<a.ROWS;n++)for(var o=0;o<a.COLS;o++)g===!0&&"R"===b[n][o]?f[n][o]=!0:h===!0&&"G"===b[n][o]?f[n][o]=!0:j===!0&&"B"===b[n][o]&&(f[n][o]=!0),f[n][o]===!0&&d++;for(var o=a.COLS-1;o>=0;o--)for(var q=a.ROWS-1,n=a.ROWS-1;n>=0;n--){var r=m(e,f,q,n,o);q=r.flag,e[n][o]=r.color,q--}return{score:d,board:e}}function k(a,b){for(var c=100,d=-2,e=0;e<a.length;e++)a[e].row===b&&(c=Math.min(a[e].col,c),d=Math.max(a[e].col,d));return{left:c,right:d}}function l(a,b){for(var c=100,d=-2,e=0;e<a.length;e++)a[e].col===b&&(c=Math.min(a[e].row,c),d=Math.max(a[e].row,d));return{left:c,right:d}}function m(a,b,d,e,f){for(;d>=0&&b[d][f]!==!1;)d--;return 0>d?{color:c(),flag:d}:{color:a[d][f],flag:d}}function n(b,c,d){b||(b=e());var g=b.board;if(o(g,c),f(b)||""!==h(b))throw new Error("Can only make a move if the game is not over!");var i=angular.copy(g),k=j(i,c);i=k.board;var l=angular.copy(b.scores);l[d]+=k.score;var m,n,p={board:i,delta:c,current_turn:b.current_turn+1,scores:l},q=h(p);return""!==q||f(p)?(n=-1,m="1"===q?[1,0]:"2"===q?[0,1]:[0,0]):(n=a.num_of_players-1-d,m=null),{endMatchScores:m,turnIndexAfterMove:n,stateAfterMove:p}}function o(a,b){for(var c=0;c<b.length;c++)if(b[c].row<0||b[c].col<0||b[c].row>=8||b[c].col>=6)throw new Error("All moves should be positive");if(b.length<=3)throw new Error("You should draw a circle with at least three points");if(b[0].row!==b[b.length-1].row||b[0].col!==b[b.length-1].col)throw new Error("You should draw a enclosed circle");if(p(b))throw new Error("You should a draw enclosed circle without duplicates");for(var c=1;c<b.length;c++){if(!(Math.abs(b[c].row-b[c-1].row)<=1&&Math.abs(b[c].col-b[c-1].col)<=1))throw new Error("Point selected should be closed to the previous one");if(a[b[c].row][b[c].col]!==a[b[c-1].row][b[c-1].col])throw log.info("after",angular.toJson(a)),new Error("Points should all be the same color")}return!0}function p(b){for(var c=[],d=0;d<b.length-1;d++)c[d]=b[d].row*a.COLS+b[d].col;var e=c.sort();log.info(e);for(var d=0;d<e.length-1;d++)if(e[d]===e[d+1])return!0;return!1}function q(a){var b=a.turnIndexBeforeMove,c=a.stateBeforeMove,d=a.move,e=a.move.stateAfterMove.delta,f=n(c,e,b);if(!angular.equals(d,f))throw new Error("Expected move="+angular.toJson(f,!0)+", but got stateTransition="+angular.toJson(a,!0))}function r(a){}function s(){var b=a.createMove(null,[{row:0,col:0}],0);log.log("move=",b);var c={turnIndexBeforeMove:0,stateBeforeMove:null,move:b,numberOfPlayers:2};a.checkMoveOk(c)}a.ROWS=8,a.COLS=6,a.num_of_players=2,a.total_turns=20,a.num_of_colors=3,a.getInitialState=e,a.createMove=n,a.checkMoveOk=q,a.checkMoveOkNoOp=r,a.forSimpleTestHtml=s}(gameLogic||(gameLogic={}));var game;!function(a){function b(){translate.setTranslations(c()),translate.setLanguage("en"),log.log("Translation of 'RULES_OF_ENCLOSECOMBAT' is "+translate("RULES_OF_ENCLOSECOMBAT")),resizeGameAreaService.setWidthToHeight(1),moveService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,checkMoveOk:gameLogic.checkMoveOkNoOp,updateUI:f}),document.addEventListener("animationend",d,!1),document.addEventListener("webkitAnimationEnd",d,!1),document.addEventListener("oanimationend",d,!1),setTimeout(d,1e3);var a=window;a.HTMLInspector&&setInterval(function(){a.HTMLInspector.inspect({excludeRules:["unused-classes","script-placement"]})},3e3)}function c(){return{RULES_OF_ENCLOSECOMBAT:{en:"Rules of EncloseCombat",cn:"画圈大战的规则"},RULES_SLIDE1:{en:"You and your opponent take turns to draw an enclosed circle over the chips of same color.",cn:"你和你的对手轮流操作，在相同颜色的卡片上围成一个闭合的形状。然后这个形状上和其内的卡片会消失，上面的会掉下来，新的卡片也会补充进来。"},RULES_SLIDE2:{en:"The more chips you include in that circle, the higher score you get.",cn:"形状越大分数越高，十个回合之后分数高的人获胜。"},CLOSE:{en:"Close",cn:"关闭"}}}function d(){log.info("Hi"),$rootScope.$apply(function(){log.info("Animation ended"),a.animationEnded=!0,e()})}function e(){a.isComputerTurn&&(a.isComputerTurn=!1,log.info("computer"),moveService.makeMove(aiService.findSimplyComputerMove(a.move)))}function f(b){log.info("Game got updateUI:",b),a.animationEnded=!1,a.move=b.move,a.state=a.move.stateAfterMove,a.state||(a.state=gameLogic.getInitialState()),a.canMakeMove=a.move.turnIndexAfterMove>=0&&b.yourPlayerIndex===a.move.turnIndexAfterMove,a.isComputerTurn=a.canMakeMove&&""===b.playersInfo[b.yourPlayerIndex].playerId,a.isComputerTurn&&(a.canMakeMove=!1,a.state.delta||e())}function g(b,c){a.moves.push({row:b,col:c})}function h(b,c){0===a.moves.length||1===a.moves.length&&a.moves[0]==={row:b,col:c}||a.moves.push({row:b,col:c})}function i(){if(log.info("Slided on cell:",angular.toJson(a.moves)),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.canMakeMove)try{var b=gameLogic.createMove(a.state,a.moves,a.move.turnIndexAfterMove);a.canMakeMove=!1,moveService.makeMove(b),a.moves=new Array}catch(c){return log.info(c),void(a.moves=new Array)}}function j(a,b){return!0}function k(b,c){return"R"===a.state.board[b][c]}function l(b,c){return"G"===a.state.board[b][c]}function m(b,c){return"B"===a.state.board[b][c]}function n(b,c){var d=!1;if(null!==a.state.delta)for(var e=0;e<a.state.delta.length;e++)a.state.delta[e].row>=b&&a.state.delta[e].col===c&&(d=!0);return!a.animationEnded&&a.state.delta&&d}function o(b){return b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.isHelpModalShown=!1),!0}a.animationEnded=!1,a.canMakeMove=!1,a.isComputerTurn=!1,a.move=null,a.state=null,a.isHelpModalShown=!1,a.moves=new Array,a.msg="",a.init=b,a.cellPressedDown=g,a.cellEnter=h,a.cellPressedUp=i,a.shouldShowImage=j,a.isPieceR=k,a.isPieceG=l,a.isPieceB=m,a.shouldSlowlyAppear=n,a.clickedOnModal=o}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){"use strict";function a(a,c,o){var p,q,r=g.offsetTop+.1*g.clientHeight,s=.9*g.clientHeight,t=c-g.offsetLeft,u=o-r;if(0>t||0>u||t>=g.clientWidth||u>=s){if(!m)return h.style.display="none",void h.offsetHeight}else{q=Math.floor(l*t/g.clientWidth),p=Math.floor(k*u/s);var v=s/2/k*(2*p+1),w=g.clientWidth/2/l*(2*q+1),x=Math.sqrt((t-w)*(t-w)+(u-v)*(u-v))/(s/2/k);if(0!==game.moves.length){var y=d(game.moves[game.moves.length-1].row,game.moves[game.moves.length-1].col);j.setAttribute("x1",y.x+""),j.setAttribute("y1",y.y+""),j.setAttribute("x2",t+""),j.setAttribute("y2",u+"")}if(x>.7)return void(("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(game.moves=new Array,i.setAttribute("points",""),h.style.display="none",h.offsetHeight));if("touchstart"!==a||n||(n={row:p,col:q},m=document.getElementById("e2e_test_div_"+n.row+"x"+n.col)),!m)return;if("touchend"===a){if(game.moves[game.moves.length-1].row!==p||game.moves[game.moves.length-1].col!==q){var z=game.isPieceR(p,q)?document.getElementById("e2e_test_pieceR_"+p+"x"+q):game.isPieceG(p,q)?document.getElementById("e2e_test_pieceG_"+p+"x"+q):document.getElementById("e2e_test_pieceB_"+p+"x"+q);z.setAttribute("r","55%"),setTimeout(function(){z.setAttribute("r","40%")},100),m=document.getElementById("e2e_test_div_"+p+"x"+q),game.moves.push({row:p,col:q})}log.info(angular.toJson(game.moves)),h.style.display="none",e(h),f()}else if((0===game.moves.length||(game.moves[game.moves.length-1].row!==p||game.moves[game.moves.length-1].col!==q)&&Math.abs(game.moves[game.moves.length-1].row-p)<=1&&Math.abs(game.moves[game.moves.length-1].col-q)<=1)&&(game.moves.length<2||2===game.moves.length&&(game.moves[0].row!==p||game.moves[0].col!==q)||game.moves.length>2&&!b(game.moves,p,q))){var z=game.isPieceR(p,q)?document.getElementById("e2e_test_pieceR_"+p+"x"+q):game.isPieceG(p,q)?document.getElementById("e2e_test_pieceG_"+p+"x"+q):document.getElementById("e2e_test_pieceB_"+p+"x"+q);z.setAttribute("r","45%"),setTimeout(function(){z.setAttribute("r","40%")},100),m=document.getElementById("e2e_test_div_"+p+"x"+q),game.moves.push({row:p,col:q}),h.style.display="block","touchstart"===a&&(j.setAttribute("x1","0"),j.setAttribute("y1","0"),j.setAttribute("x2","0"),j.setAttribute("y2","0"));var A=d(p,q);if(1==game.moves.length)i.setAttribute("points",A.x+","+A.y+" ");else{var B=i.getAttribute("points");i.setAttribute("points",B+A.x+","+A.y+" ")}}}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(n=null,m=null,h.style.display="none",h.offsetHeight,game.moves=new Array)}function b(a,b,c){for(var d=1;d<a.length;d++)if(a[d].row===b&&a[d].col===c)return!0;return!1}function c(){return{width:g.clientWidth/l,height:.9*g.clientHeight/k}}function d(a,b){var d=c();return{x:b*d.width+d.width/2,y:a*d.height+d.height/2}}function e(a){if(a){var b=document.createTextNode(" "),c=a.style.display;a.appendChild(b),a.style.display="none",setTimeout(function(){a.style.display=c,b.parentNode.removeChild(b)},0)}}function f(){$rootScope.$apply(function(){game.cellPressedUp()})}var g=document.getElementById("gameArea"),h=document.getElementById("draggingLines"),i=document.getElementById("pline"),j=document.getElementById("pline2");dragAndDropService.addDragListener("gameArea",a);var k=gameLogic.ROWS,l=gameLogic.COLS,m=null,n=null;$rootScope.game=game,game.init(),resizeGameAreaService.setWidthToHeight(.6818)});var aiService;!function(a){function b(a){for(var b=null,c=1;c<gameLogic.ROWS-1;c++)for(var d=1;d<gameLogic.COLS-1;d++){var e=new Array;try{return e.push({row:c-1,col:d}),e.push({row:c,col:d+1}),e.push({row:c+1,col:d}),e.push({row:c,col:d-1}),e.push({row:c-1,col:d}),b=gameLogic.createMove(a.stateAfterMove,e,a.turnIndexAfterMove)}catch(f){}}for(var c=0;c<gameLogic.ROWS;c++)for(var d=1;d<gameLogic.COLS;d++)for(var g=0;3>=g;g++)try{var e=new Array;switch(e.push({row:c,col:d-1}),e.push({row:c,col:d}),g){case 0:e.push({row:c-1,col:d-1});break;case 1:e.push({row:c-1,col:d});break;case 2:e.push({row:c+1,col:d});break;case 3:e.push({row:c+1,col:d-1})}return e.push({row:c,col:d-1}),b=gameLogic.createMove(a.stateAfterMove,e,a.turnIndexAfterMove)}catch(f){}return b}function c(a){for(var b=null,c=0,e=new Array,f=new Array,g=new Array,h=0;h<gameLogic.ROWS;h++){f[h]=new Array;for(var i=0;i<gameLogic.COLS;i++)f[h][i]=!1}log.info("rrr");try{for(var h=0;h<gameLogic.ROWS;h++)for(var i=0;i<gameLogic.COLS;i++){var j=d(a.stateAfterMove.board,h,i,"",g,f);j.len>c&&(e=j.moves)}b=gameLogic.createMove(a.stateAfterMove,e,a.turnIndexAfterMove)}catch(k){log.info(k)}return b}function d(a,b,c,e,f,g){if(0>b||b>gameLogic.ROWS||0>c||c>gameLogic.COLS||""!==e&&a[b][c]!==e)return{len:0,moves:null};if(""!==e&&null!==f&&f.length>=3&&g[b][c]===!0&&b===f[0].row&&c===f[0].col)return f.push({row:b,col:c}),{len:f.length-1,moves:f};""===e&&(e=a[b][c]),g[b][c]=!0,f.push({row:b,col:c});var h=new Array;b+1<gameLogic.ROWS&&a[b+1][c]===e&&h.push(d(a,b+1,c,e,f,g)),b+1<gameLogic.ROWS&&c+1<gameLogic.COLS&&a[b+1][c+1]===e&&h.push(d(a,b+1,c+1,e,f,g)),b+1<gameLogic.ROWS&&c-1>0&&a[b+1][c-1]===e&&h.push(d(a,b+1,c-1,e,f,g)),c+1<gameLogic.COLS&&a[b][c+1]===e&&h.push(d(a,b,c+1,e,f,g)),c-1>0&&a[b][c-1]===e&&h.push(d(a,b,c-1,e,f,g)),b-1>0&&c-1>0&&a[b-1][c-1]===e&&h.push(d(a,b-1,c-1,e,f,g)),b-1>0&&a[b-1][c]===e&&h.push(d(a,b-1,c,e,f,g)),b-1>0&&c+1<gameLogic.COLS&&a[b-1][c+1]===e&&h.push(d(a,b-1,c+1,e,f,g)),f.pop(),g[b][c]=!1;for(var i=0,j=new Array,k=0;k<h.length;k++)h[k].len>i&&(i=h[k].len,j=h[k].moves);return{len:i,moves:j}}function e(a){return g(a,{millisecondsLimit:1e3})}function f(a,b){for(var c=[],d=0;d<gameLogic.ROWS;d++)for(var e=0;e<gameLogic.COLS;e++)try{}catch(f){}return c}function g(a,b){return alphaBetaService.alphaBetaDecision(a,a.turnIndexAfterMove,i,h,null,b)}function h(a,b){var c=a.endMatchScores;return c?c[0]>c[1]?Number.POSITIVE_INFINITY:c[0]<c[1]?Number.NEGATIVE_INFINITY:0:0}function i(a,b){return f(a.stateAfterMove,b)}a.findSimplyComputerMove=b,a.findCleverComputerMove=c,a.findComputerMove=e,a.getPossibleMoves=f,a.createComputerMove=g}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map